[CMD] /home/ryreu/miniconda3/envs/gals_a100/bin/python -u main.py --config configs/waterbirds_100_abn_vit.yaml --name abn_att_waterbird_1.0_forest2water2_21047520_trial_000 DATA.ROOT=/home/ryreu/guided_cnn/waterbirds DATA.WATERBIRDS_DIR=waterbird_1.0_forest2water2 SEED=0 EXP.BASE.LR=0.0010000000000000002 EXP.CLASSIFIER.LR=9.999999999999991e-05 EXP.WEIGHT_DECAY=9.999999999999997e-06 EXP.AUX_LOSSES_ON_VAL=False EXP.LOSSES.ABN_SUPERVISION.WEIGHT=1.0 EXP.NUM_EPOCHS=1
SEED: 0
DATA:
  BATCH_SIZE: 96
  NUM_WORKERS: 4
  SIZE: 224
  NORMALIZATION: imagenet
  ATTENTION_DIR: clip_vit_attention
  SEPARATE_CLASSES: false
  REMOVE_BACKGROUND: false
  ROOT: /home/ryreu/guided_cnn/waterbirds
  USE_CLASS_WEIGHTS: false
  USE_GROUP_WEIGHTS: false
  DATASET: waterbirds
  NUM_CLASSES: 2
  CONFOUNDING_FACTOR: 1.0
  WATERBIRDS_DIR: waterbird_1.0_forest2water2
EXP:
  NUM_TRIALS: 1
  LOSSES:
    CLASSIFICATION:
      WEIGHT: 1
    GRADIENT_OUTSIDE:
      COMPUTE: false
      LOG: false
      WEIGHT: 0.01
      CRITERION: L1
      GT: segmentation
      COMBINE_ATT_MODE: average_nonzero
    GRADIENT_INSIDE:
      COMPUTE: false
      LOG: false
      WEIGHT: 1
      CRITERION: L1
      GT: segmentation
      COMBINE_ATT_MODE: average_nonzero
    GRADCAM:
      COMPUTE: false
      LOG: false
      WEIGHT: 1
      CRITERION: L1
      GT: segmentation
      MODE: match
      COMBINE_ATT_MODE: average_nonzero
    ABN_CLASSIFICATION:
      COMPUTE: true
      LOG: false
      WEIGHT: 1
    ABN_SUPERVISION:
      COMPUTE: true
      LOG: false
      WEIGHT: 1.0
      CRITERION: L1
      GT: clip_vit
      MODE: suppress_outside
      COMBINE_ATT_MODE: average_nonzero
  APPROACH: abn
  MODEL: resnet50_abn
  PRETRAINED: true
  PROVIDED_ATT: NONE
  PROVIDED_ATT_SHAPE:
  - 14
  - 14
  ABN_ADD_AFTER_ATTENTION: true
  NUM_EPOCHS: 1
  OPTIMIZER: SGD
  WEIGHT_DECAY: 9.999999999999997e-06
  MOMENTUM: 0.9
  SCHEDULER: NONE
  BASE:
    LR: 0.0010000000000000002
  CLASSIFIER:
    LR: 9.999999999999991e-05
  AUX_LOSSES_ON_VAL: false
LOGGING:
  SAVE_EVERY: 0
  SAVE_BEST: true
  SAVE_LAST: false
  LOG_ATTENTION: false
  LOG_ATTENTION_STEP: 10
  SAVE_STATS_PATH: null
yaml: configs/waterbirds_100_abn_vit.yaml
name: abn_att_waterbird_1.0_forest2water2_21047520_trial_000
test_checkpoint: null

WATERBIRDS DIR: /home/ryreu/guided_cnn/waterbirds/waterbird_1.0_forest2water2
NUMBER OF SAMPLES WITH LABEL Landbird: 3684
NUMBER OF SAMPLES WITH LABEL Waterbird: 1111
NUMBER OF SAMPLES WITH GROUP Land_on_Land: 3684
NUMBER OF SAMPLES WITH GROUP Land_on_Water: 0
NUMBER OF SAMPLES WITH GROUP Water_on_Land: 0
NUMBER OF SAMPLES WITH GROUP Water_on_Water: 1111
WATERBIRDS DIR: /home/ryreu/guided_cnn/waterbirds/waterbird_1.0_forest2water2
NUMBER OF SAMPLES WITH LABEL Landbird: 931
NUMBER OF SAMPLES WITH LABEL Waterbird: 268
NUMBER OF SAMPLES WITH GROUP Land_on_Land: 465
NUMBER OF SAMPLES WITH GROUP Land_on_Water: 466
NUMBER OF SAMPLES WITH GROUP Water_on_Land: 134
NUMBER OF SAMPLES WITH GROUP Water_on_Water: 134
NUM TRAIN: 4795

NUM VAL:   1199

Number classifier outputs: 1
Using pretrained model: True
Removing att_conv.weight from pretained weights, with weight shape torch.Size([1000, 2048, 1, 1])
Removing bn_att2.weight from pretained weights, with weight shape torch.Size([1000])
Removing bn_att2.bias from pretained weights, with weight shape torch.Size([1000])
Removing bn_att2.running_mean from pretained weights, with weight shape torch.Size([1000])
Removing bn_att2.running_var from pretained weights, with weight shape torch.Size([1000])
Removing att_conv2.weight from pretained weights, with weight shape torch.Size([1000, 1000, 1, 1])
Removing att_conv3.weight from pretained weights, with weight shape torch.Size([1, 1000, 3, 3])
Removing fc.weight from pretained weights, with weight shape torch.Size([1000, 2048])
Removing fc.bias from pretained weights, with weight shape torch.Size([1000])
Keys missing in state dict:    ['att_conv.weight', 'bn_att2.weight', 'bn_att2.bias', 'bn_att2.running_mean', 'bn_att2.running_var', 'att_conv2.weight', 'att_conv3.weight', 'fc.weight', 'fc.bias']
Unexpected keys in state dict: []
USING SGD OPTIMIZER
class weights: None
group weights: None
WANDB DISABLED: skipping wandb.init()
EPOCH: 0

>>> TRAINING 


  0%|          | 0/50 [00:00<?, ?it/s]
  2%|▏         | 1/50 [00:03<02:54,  3.57s/it]
  4%|▍         | 2/50 [00:03<01:17,  1.62s/it]
  6%|▌         | 3/50 [00:04<00:46,  1.01it/s]
  8%|▊         | 4/50 [00:04<00:32,  1.44it/s]
 10%|█         | 5/50 [00:04<00:24,  1.87it/s]
 12%|█▏        | 6/50 [00:04<00:19,  2.30it/s]
 14%|█▍        | 7/50 [00:05<00:16,  2.68it/s]
 16%|█▌        | 8/50 [00:05<00:14,  2.99it/s]
 18%|█▊        | 9/50 [00:05<00:12,  3.27it/s]
 20%|██        | 10/50 [00:05<00:11,  3.49it/s]
 22%|██▏       | 11/50 [00:06<00:10,  3.65it/s]
 24%|██▍       | 12/50 [00:06<00:10,  3.76it/s]
 26%|██▌       | 13/50 [00:06<00:09,  3.86it/s]
 28%|██▊       | 14/50 [00:06<00:09,  3.94it/s]
 30%|███       | 15/50 [00:07<00:08,  3.99it/s]
 32%|███▏      | 16/50 [00:07<00:08,  4.02it/s]
 34%|███▍      | 17/50 [00:07<00:08,  4.06it/s]
 36%|███▌      | 18/50 [00:07<00:07,  4.09it/s]
 38%|███▊      | 19/50 [00:07<00:07,  4.09it/s]
 40%|████      | 20/50 [00:08<00:07,  4.09it/s]
 42%|████▏     | 21/50 [00:08<00:07,  4.09it/s]
 44%|████▍     | 22/50 [00:08<00:06,  4.12it/s]
 46%|████▌     | 23/50 [00:08<00:06,  4.11it/s]
 48%|████▊     | 24/50 [00:09<00:06,  4.15it/s]
 50%|█████     | 25/50 [00:09<00:06,  4.16it/s]
 52%|█████▏    | 26/50 [00:09<00:05,  4.18it/s]
 54%|█████▍    | 27/50 [00:09<00:05,  4.17it/s]
 56%|█████▌    | 28/50 [00:10<00:05,  4.19it/s]
 58%|█████▊    | 29/50 [00:10<00:05,  4.17it/s]
 60%|██████    | 30/50 [00:10<00:04,  4.17it/s]
 62%|██████▏   | 31/50 [00:10<00:04,  4.17it/s]
 64%|██████▍   | 32/50 [00:11<00:04,  4.16it/s]
 66%|██████▌   | 33/50 [00:11<00:04,  4.13it/s]
 68%|██████▊   | 34/50 [00:11<00:03,  4.14it/s]
 70%|███████   | 35/50 [00:11<00:03,  4.17it/s]
 72%|███████▏  | 36/50 [00:12<00:03,  4.18it/s]
 74%|███████▍  | 37/50 [00:12<00:03,  4.17it/s]
 76%|███████▌  | 38/50 [00:12<00:02,  4.19it/s]
 78%|███████▊  | 39/50 [00:12<00:02,  4.22it/s]
 80%|████████  | 40/50 [00:13<00:02,  4.17it/s]
 82%|████████▏ | 41/50 [00:13<00:02,  4.13it/s]
 84%|████████▍ | 42/50 [00:13<00:01,  4.12it/s]
 86%|████████▌ | 43/50 [00:13<00:01,  4.16it/s]
 88%|████████▊ | 44/50 [00:13<00:01,  4.19it/s]
 90%|█████████ | 45/50 [00:14<00:01,  4.20it/s]
 92%|█████████▏| 46/50 [00:14<00:00,  4.15it/s]
 94%|█████████▍| 47/50 [00:14<00:00,  4.13it/s]
 96%|█████████▌| 48/50 [00:14<00:00,  4.13it/s]
 98%|█████████▊| 49/50 [00:15<00:00,  4.16it/s]
100%|██████████| 50/50 [00:15<00:00,  4.22it/s]
100%|██████████| 50/50 [00:15<00:00,  3.23it/s]
>>> VALIDATING 


  0%|          | 0/13 [00:00<?, ?it/s]
  0%|          | 0/13 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "main.py", line 205, in <module>
    main(args)
  File "main.py", line 147, in main
    approach.train()
  File "/home/ryreu/guided_cnn/waterbirds/Waterbird_Runs/GALS/approaches/base.py", line 345, in train
    metrics = self.validate(metrics)
  File "/home/ryreu/guided_cnn/waterbirds/Waterbird_Runs/GALS/approaches/base.py", line 416, in validate
    metrics = self.eval_batch(data, metrics, mode='val')
  File "/home/ryreu/guided_cnn/waterbirds/Waterbird_Runs/GALS/approaches/base.py", line 264, in eval_batch
    loss, metrics = self.calc_loss(metrics, 'val', batch, inputs, output_dict, labels, aux_losses=False)
TypeError: calc_loss() got an unexpected keyword argument 'aux_losses'
